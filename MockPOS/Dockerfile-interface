# For more information, please refer to https://aka.ms/vscode-docker-python
FROM python:slim-bookworm

# Keeps Python from generating .pyc files in the container
ENV PYTHONDONTWRITEBYTECODE=1

# Turns off buffering for easier container logging
ENV PYTHONUNBUFFERED=1

# Install SSH, curl, and other essentials
RUN apt-get update && apt-get install -y \
    openssh-server \
    curl \
    vim \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

# Set the working directory to /interface
WORKDIR /interface

# Copy the application code
COPY interface/interface.py /interface/interface.py

# Copy the requirements file
COPY interface/requirements.txt /interface/requirements.txt

# Install dependencies with pip
RUN pip install -r requirements.txt

# Create necessary directories and set permissions for SSH
RUN mkdir /var/run/sshd && \
    chmod 0755 /var/run/sshd

# Generate SSH host keys
RUN ssh-keygen -A

# Configure SSH
RUN sed -i 's/#PermitRootLogin prohibit-password/PermitRootLogin yes/' /etc/ssh/sshd_config && \
    sed -i 's/#Port 22/Port 22/' /etc/ssh/sshd_config

# Set root password
RUN echo 'root:password' | chpasswd

# Expose port 22 for SSH
EXPOSE 22

# Start SSH service as root user
CMD ["/usr/sbin/sshd", "-D"]